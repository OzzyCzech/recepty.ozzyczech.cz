<!--
slug: .
-->

<input type="search" id="q" placeholder="Vyhledej recept">

<div id="results"></div>

<script>
	document.onreadystatechange = function () {
		if (document.readyState == 'complete') {

			// https://fusejs.io/ search

			(async () => {
				const response = await fetch('/index.json');
				const index = await response.json();

				const fuse = new Fuse(index, {
					shouldSort: true,
					findAllMatches: true,
					threshold: 0.5,
					location: 0,
					distance: 100,
					maxPatternLength: 32,
					minMatchCharLength: 1,
					keys: [
						{name: "title", weight: 0.8},
						{name: "tags", weight: 0.6},
						{name: "content", weight: 0.3}
					]
				});


				const q = document.getElementById('q');
				const o = document.getElementById('results');

				const search = (event) => {
					let results = fuse.search(q.value);
					if (q.value.length === 0) {
						o.innerHTML = '';
					} else {
						o.innerHTML = '<h1 class="h3">Search results:</h1>';
					}

					results.map((page) => {
						o.insertAdjacentHTML("beforeend", `
						<article>
							<h2 class="h1">
								<a href="${page.link}">${page.title}</a>
							</h2>
							<p class="text-secondary small">${page.content}</p>
						</article>`);
					});
					event.preventDefault();
				};


				['keyup', 'change'].forEach((e) => {
					q.addEventListener(e, (event) => {
						search(event)
					}, false)
				});

			})();

		}
	};
</script>